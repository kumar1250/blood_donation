{% extends "base.html" %}
{% block title %}Blood Requests{% endblock %}

{% block content %}
<h2>Blood Requests</h2>

<a href="{% url 'blood_requests:request_form' %}" class="btn" style="margin-bottom: 15px;">âž• New Request</a>

{% if requests %}
    {% for br in requests %}
        <div class="container" style="margin-top:15px; padding:15px; border:1px solid #333; border-radius: 8px;">
            <h3>{{ br.name }} ({{ br.blood_group }}) 
                {% if br.emergency %}
                    <span style="color:yellow;">âš  Emergency</span>
                {% endif %}
            </h3>
            <p><strong>Address:</strong> {{ br.address }}</p>
            <p><strong>Reason:</strong> {{ br.reason|default:"N/A" }}</p>
            <p><strong>Requested By:</strong> {{ br.requester.username }}</p>

            <div style="margin-top: 10px;">
                {% if request.user == br.requester %}
                    <form action="{% url 'blood_requests:delete_request' br.id %}" method="POST" style="display:inline;">
                        {% csrf_token %}
                        <button type="submit" class="btn">ðŸ—‘ Delete</button>
                    </form>
                {% else %}
                    {% if request.user not in br.accepted_donors.all %}
                        <a href="{% url 'blood_requests:accept_request' br.id %}" class="btn">âœ… Accept</a>
                    {% else %}
                        <span class="alert-info">Already Accepted</span>

                        {% if not br.otp_verified %}
                            <a href="{% url 'blood_requests:verify_otp' br.id %}" class="btn">ðŸ”‘ Verify OTP</a>
                        {% endif %}
                    {% endif %}
                {% endif %}
            </div>
        </div>
    {% endfor %}
{% else %}
    <p>No blood requests found.</p>
{% endif %}
{% endblock %}
