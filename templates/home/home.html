{% extends "base.html" %}
{% block title %}Home{% endblock %}
{% block content %}
<div class="container mt-5">
    <h1 class="mb-4 text-danger">Welcome, {{ request.user.username }}!</h1>

    <h3 class="mt-4 mb-3 text-danger">Quick Actions</h3>
    <div class="row g-4">
        <div class="col-md-4 col-sm-6">
            <a href="{% url 'blood_requests:request_form' %}" class="card text-white bg-danger h-100 text-center text-decoration-none">
                <div class="card-body py-4"><i class="bi bi-plus-circle-fill fs-1"></i><h5 class="mt-3">Create Blood Request</h5></div>
            </a>
        </div>
        <div class="col-md-4 col-sm-6">
            <a href="{% url 'blood_requests:request_list' %}" class="card text-white bg-danger h-100 text-center text-decoration-none">
                <div class="card-body py-4"><i class="bi bi-list-ul fs-1"></i><h5 class="mt-3">View All Requests</h5></div>
            </a>
        </div>
        <div class="col-md-4 col-sm-6">
            <a href="{% url 'blood_camp:create_camp' %}" class="card text-white bg-danger h-100 text-center text-decoration-none">
                <div class="card-body py-4"><i class="bi bi-plus-square-fill fs-1"></i><h5 class="mt-3">Create Blood Camp</h5></div>
            </a>
        </div>
        <div class="col-md-4 col-sm-6">
            <a href="{% url 'blood_camp:camp_list' %}" class="card text-white bg-danger h-100 text-center text-decoration-none">
                <div class="card-body py-4"><i class="bi bi-geo-alt-fill fs-1"></i><h5 class="mt-3">View All Camps</h5></div>
            </a>
        </div>
        <div class="col-md-4 col-sm-6">
            <a href="{% url 'chat:chat_home' %}" class="card text-white bg-danger h-100 text-center text-decoration-none">
                <div class="card-body py-4"><i class="bi bi-chat-dots-fill fs-1"></i><h5 class="mt-3">Chat</h5></div>
            </a>
        </div>
    </div>

    <h3 class="mt-5 mb-3 text-danger">Nearby Donors</h3>
    <div id="homeMap" style="height: 450px; border-radius: 10px;"></div>
</div>

<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"/>
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

<script>
const donorIcon = L.icon({ iconUrl: 'https://cdn-icons-png.flaticon.com/512/684/684908.png', iconSize: [30,30] });
const meIcon = L.icon({ iconUrl: 'https://cdn-icons-png.flaticon.com/512/252/252025.png', iconSize: [30,30] });

const map = L.map('homeMap').setView([20.5937, 78.9629], 5);
L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', { maxZoom: 19 }).addTo(map);

let myMarker = null;

if (navigator.geolocation) {
    navigator.geolocation.watchPosition(pos => {
        const lat = pos.coords.latitude, lng = pos.coords.longitude;
        if (myMarker) map.removeLayer(myMarker);
        myMarker = L.marker([lat,lng], {icon: meIcon}).addTo(map).bindPopup("You are here");
    }, console.error, { enableHighAccuracy: true, maximumAge: 0, timeout: 5000 });
}

// Remove live_tracking updates since app is deleted
// If you want, you can later fetch donor data from a new API
</script>
{% endblock %}
